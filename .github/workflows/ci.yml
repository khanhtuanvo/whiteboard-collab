name: CI pipeline 

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    env:
      DATABASE_URL: mysql://test:test@localhost:3306/test_db
      JWT_SECRET: ci-test-secret
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4 
      with: { node-version: '20' }
    - run: cd backend && npm ci 
    - run: cd backend && npx prisma generate
    - run: cd backend && npx jest